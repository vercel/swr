---
image: https://assets.vercel.com/image/upload/v1670542323/swr/v2.png
description: 'SWR 2.0 å‘å¸ƒï¼šæ–°çš„æ•°æ®æ›´æ”¹ APIã€ç»è¿‡ä¼˜åŒ–çš„ä¹è§‚ UI åŠŸèƒ½ã€æ–°çš„ DevToolsã€ä»¥åŠå¯¹å¹¶å‘æ¸²æŸ“çš„æ›´å¥½æ”¯æŒï¼Œä»¥åŠæ›´å¤šåŠŸèƒ½ã€‚'
date: December 9th, 2022
---

import { Callout } from 'nextra-theme-docs'
import { Bleed } from 'nextra-theme-docs'

import Authors, { Author } from 'components/authors'
import Video from 'components/video'

# SWR 2.0 å‘å¸ƒ [#announcing-swr-20]

<Authors date="December 9th, 2022">
  <Author name="Shu Ding" link="https://twitter.com/shuding_" />
  <Author name="Jiachi Liu" link="https://twitter.com/huozhi" />
  <Author name="Toru Kobayashi" link="https://twitter.com/koba04" />
  <Author name="Yixuan Xu" link="https://twitter.com/yixuanxu94" />
</Authors>

æˆ‘ä»¬å¾ˆé«˜å…´å®£å¸ƒ SWR 2.0 çš„å‘å¸ƒï¼ŒSWR æ˜¯ä¸€æ¬¾ä¸»æµçš„ React æ•°æ®è¯·æ±‚åº“ï¼Œå®ƒä½¿ç»„ä»¶èƒ½å¤Ÿè·å–ã€ç¼“å­˜åŠæ›´æ”¹æ•°æ®ï¼Œå¹¶ä½¿ UI èƒ½éšæ—¶é—´å˜åŒ–ä¿æŒæœ€æ–°çš„æ•°æ®ã€‚

åœ¨æ–°ç‰ˆæœ¬ä¸­åŒ…å«äº†å¾ˆå¤šä¼˜åŒ–å’Œæ–°åŠŸèƒ½ï¼Œä¾‹å¦‚æ–°çš„æ•°æ®æ›´æ”¹ APIã€ç»è¿‡ä¼˜åŒ–çš„ä¹è§‚ UI åŠŸèƒ½ã€æ–°çš„ DevToolsã€ä»¥åŠå¯¹å¹¶å‘æ¸²æŸ“çš„æ›´å¥½æ”¯æŒã€‚è¡·å¿ƒæ„Ÿè°¢æ‰€æœ‰ä½¿è¿™ä¸ªç‰ˆæœ¬æˆä¸ºå¯èƒ½çš„è´¡çŒ®è€…å’Œç»´æŠ¤è€…ã€‚

## æ•°æ®æ›´æ”¹å’Œä¹è§‚ UI [#mutation-and-optimistic-ui]

### useSWRMutation [#useswrmutation]

æ•°æ®æ›´æ”¹ï¼ˆMutationï¼‰æ˜¯æ•°æ®è¯·æ±‚è¿‡ç¨‹ä¸­éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä½¿ä½ å¯ä»¥ä¿®æ”¹æœ¬åœ°æˆ–è€…è¿œç¨‹çš„æ•°æ®ã€‚æˆ‘ä»¬ç›®å‰ä½¿ç”¨çš„ `mutate` API å…è®¸ä½ æ‰‹åŠ¨é‡æ–°éªŒè¯æˆ–æ›´æ–°èµ„æºã€‚åœ¨ SWR 2.0 ä¸­ï¼Œæ–°çš„ hook `useSWRMutation` ä½¿ç”¨äº†å£°æ˜å¼çš„ API ï¼Œä½¿æ›´æ”¹è¿œç¨‹æ•°æ®æ›´åŠ ç®€å•ã€‚ä½ å¯ä»¥ä½¿ç”¨ hook è®¾ç½®ä¸€ä¸ªæ•°æ®æ›´æ”¹ï¼Œå¹¶åœ¨éšåè§¦å‘å®ƒã€‚

```jsx {11,16}
import useSWRMutation from 'swr/mutation'

async function sendRequest(url, { arg }) {
  return fetch(url, {
    method: 'POST',
    body: JSON.stringify(arg)
  })
}

function App() {
  const { trigger, isMutating } = useSWRMutation('/api/user', sendRequest)

  return (
    <button
      disabled={isMutating}
      onClick={() => trigger({ username: 'johndoe' })}
    >{
      isMutating ? 'Creating...' : 'Create User'
    }</button>
  )
}
```

ä¸Šé¢çš„ä¾‹å­ä¸­å®šä¹‰äº†ä¸€ä¸ªå½±å“ `/api/user` èµ„æºçš„ `sendRequest` æ•°æ®æ›´æ”¹ã€‚ä¸ `useSWR` ä¸åŒï¼Œ`useSWRMutation` å¹¶ä¸ä¼šåœ¨æ¸²æŸ“æ—¶ç«‹å³å‘é€è¯·æ±‚ï¼Œè€Œæ˜¯ä¼šè¿”å›ä¸€ä¸ª `trigger` å‡½æ•°ï¼Œä¹‹åä½ å¯ä»¥æ‰‹åŠ¨è°ƒç”¨è¯¥å‡½æ•°è§¦å‘æ•°æ®æ›´æ”¹ã€‚

`sendRequest` å‡½æ•°ä¼šåœ¨æŒ‰é’®è¢«ç‚¹å‡»æ—¶è§¦å‘ï¼Œå¹¶ä¼ å…¥é¢å¤–çš„å‚æ•° `{ username: 'johndoe' }`ã€‚`isMutating` çš„å€¼ä¼šè¢«è®¾ç½®ä¸º `true` ç›´åˆ°æ•°æ®æ›´æ”¹çš„è¯·æ±‚å®Œæˆã€‚

æ­¤å¤–ï¼Œè¿™ä¸ªæ–°çš„ hook è¿˜è§£å†³äº†æ•°æ®æ›´æ”¹å¯èƒ½å¸¦æ¥çš„å…¶ä»–é—®é¢˜:

- å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¹è§‚åœ°æ›´æ–° UI
- åœ¨æ•°æ®æ›´æ”¹å¤±è´¥æ—¶è‡ªåŠ¨å›æ»š
- é¿å…äº† `useSWR` å’ŒåŒä¸€èµ„æºçš„å…¶ä»–æ•°æ®æ›´æ”¹ä¹‹é—´ä»»ä½•æ½œåœ¨çš„ç«æ€æ¡ä»¶ã€‚
- æ•°æ®æ›´æ”¹å®Œæˆåï¼Œå¡«å…… `useSWR` ç¼“å­˜ã€‚
- ...

é€šè¿‡é˜…è¯» [æ–‡æ¡£](/docs/mutation#useswrmutation) æˆ–é˜…è¯»æ¥ä¸‹æ¥çš„å‡ èŠ‚ï¼Œä½ å¯ä»¥æ‰¾åˆ°æ›´åŠ æ·±å…¥çš„ API å‚è€ƒå’Œç¤ºä¾‹ã€‚

### ä¹è§‚ UI [#optimistic-ui]

ä¹è§‚ UI æ˜¯ä¸€ç§ä¼˜ç§€çš„æ¨¡å‹ï¼Œç”¨äºåˆ›å»ºè®©äººæ„Ÿè§‰å¿«é€Ÿå’Œæ•æ·çš„ç½‘ç«™ï¼›ç„¶è€Œï¼Œå®ƒå¯èƒ½å¾ˆéš¾æ­£ç¡®çš„å»å®ç°ã€‚SWR 2.0 å¢åŠ äº†ä¸€äº›å¼ºå¤§çš„æ–°é€‰é¡¹ï¼Œä½¿ä¹è§‚ UI çš„å®ç°æ›´åŠ å®¹æ˜“ã€‚

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª API ç”¨äºæ·»åŠ ä¸€ä¸ªæ–°çš„å¾…åŠäº‹é¡¹åˆ°å¾…åŠåˆ—è¡¨ä¸­ï¼Œå¹¶å°†å®ƒå‘é€åˆ°æœåŠ¡ç«¯ï¼š

```jsx
await addNewTodo('New Item')
```

åœ¨æˆ‘ä»¬çš„ UI ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `useSWR` è¿™ä¸ª hook å»å±•ç¤ºå¾…åŠåˆ—è¡¨ï¼Œå…¶ä¸­çš„ "Add New Item" æŒ‰é’®ç”¨äºè§¦å‘è¿™ä¸ªè¯·æ±‚å¹¶è¦æ±‚ SWR é€šè¿‡ `mutate()` é‡æ–°è·å–æ•°æ®ï¼š

```jsx {7,8}
const { mutate, data } = useSWR('/api/todos')

return <>
  <ul>{/* å±•ç¤ºæ•°æ® */}</ul>

  <button onClick={async () => {
    await addNewTodo('New Item')
    mutate()
  }}>
    Add New Item
  </button>
</>
```

ç„¶è€Œï¼Œ`await addNewTodo(...)` è¯·æ±‚å¯èƒ½ä¼šç‰¹åˆ«æ…¢ã€‚å½“å®ƒæ­£åœ¨è¯·æ±‚æ—¶ï¼Œç”¨æˆ·çœ‹åˆ°ä»ç„¶æ˜¯æ—§çš„åˆ—è¡¨ï¼Œå³ä½¿æˆ‘ä»¬å·²ç»çŸ¥é“æ–°çš„åˆ—è¡¨ä¼šæ˜¯ä»€ä¹ˆæ ·å­ã€‚æœ‰äº†æ–°çš„ `optimisticData` é€‰é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡ç«¯å“åº”ä¹‹å‰ï¼Œä¹è§‚åœ°å±•ç¤ºæ–°çš„åˆ—è¡¨ï¼š

```jsx {8}
const { mutate, data } = useSWR('/api/todos')

return <>
  <ul>{/* å±•ç¤ºæ•°æ® */}</ul>

  <button onClick={() => {
    mutate(addNewTodo('New Item'), {
      optimisticData: [...data, 'New Item'],
    })
  }}>
    Add New Item
  </button>
</>
```

SWR å°†ç«‹å³ç”¨ `optimisticData` å€¼å»æ›´æ–° `data`ï¼Œç„¶åå°†è¯·æ±‚å‘é€åˆ°æœåŠ¡ç«¯ã€‚ä¸€æ—¦è¯·æ±‚å®Œæˆï¼ŒSWR å°†é‡æ–°éªŒè¯è¯¥èµ„æºä»¥ç¡®ä¿å®ƒæ˜¯æœ€æ–°çš„ã€‚

åƒè®¸å¤š API ä¸€æ ·ï¼Œå¦‚æœ `addNewTodo(...)` è¯·æ±‚ä¼šä»æœåŠ¡ç«¯è¿”å›æœ€æ–°çš„æ•°æ®ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥æ˜¾ç¤ºè¿™ä¸ªç»“æœï¼ˆè€Œä¸æ˜¯å¼€å§‹ä¸€ä¸ªæ–°çš„é‡æ–°éªŒè¯ï¼‰! è¿˜æœ‰ä¸€ä¸ªæ–°çš„ `populateCache` é€‰é¡¹ï¼Œå‘Šè¯‰ SWR ç”¨ mutate çš„å“åº”å»æ›´æ–°æœ¬åœ°æ•°æ®ï¼š


```jsx {9}
const { mutate, data } = useSWR('/api/todos')

return <>
  <ul>{/* å±•ç¤ºæ•°æ® */}</ul>

  <button onClick={() => {
    mutate(addNewTodo('New Item'), {
      optimisticData: [...data, 'New Item'],
      populateCache: true,
    })
  }}>
    Add New Item
  </button>
</>
```

åŒæ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨è¯·æ±‚åè¿›è¡Œé‡æ–°éªŒè¯äº†ï¼Œå› ä¸ºå“åº”çš„æ•°æ®æ¥è‡ªçœŸå®çš„æ•°æ®æºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `revalidate` é€‰é¡¹ç¦ç”¨å®ƒï¼š

```jsx {10}
const { mutate, data } = useSWR('/api/todos')

return <>
  <ul>{/* å±•ç¤ºæ•°æ® */}</ul>

  <button onClick={() => {
    mutate(addNewTodo('New Item'), {
      optimisticData: [...data, 'New Item'],
      populateCache: true,
      revalidate: false,
    })
  }}>
    Add New Item
  </button>
</>
```

æœ€åï¼Œå¦‚æœ `addNewTodo(...)` å› ä¸ºæ„å¤–æƒ…å†µå¤±è´¥äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°† `rollbackOnError` è®¾ç½®ä¸º `true`ï¼ˆè¯¥é€‰é¡¹é»˜è®¤å¼€å¯ï¼‰ä»¥å›æ»šåˆšåˆšè®¾ç½®çš„ä¹è§‚æ•°æ®ï¼ˆ`[...data, 'New Item']`ï¼‰ã€‚ä¸€æ—¦å‡ºç°è¿™ç§æƒ…å†µï¼ŒSWR ä¼šå°† `data` å›æ»šä¸ºä¸Šä¸€æ¬¡çš„å€¼ï¼š

```jsx {11}
const { mutate, data } = useSWR('/api/todos')

return <>
  <ul>{/* å±•ç¤ºæ•°æ® */}</ul>

  <button onClick={() => {
    mutate(addNewTodo('New Item'), {
      optimisticData: [...data, 'New Item'],
      populateCache: true,
      revalidate: false,
      rollbackOnError: true,
    })
  }}>
    Add New Item
  </button>
</>
```

æ‰€æœ‰ API éƒ½åœ¨æ–°çš„ `useSWRMutationhook` hook ä¸­å¾—åˆ°æ”¯æŒã€‚æƒ³è¦äº†è§£æ›´å¤šå…³äºå®ƒä»¬çš„ä¿¡æ¯ï¼Œä½ å¯ä»¥æŸ¥çœ‹æˆ‘ä»¬çš„ [æ–‡æ¡£](https://swr.vercel.app/docs/mutation#optimistic-updates)ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª demo ç”¨äºæ¼”ç¤ºè¿™ç§è¡Œä¸º:

<Video
  src="/video/optimistic-ui.mp4"
  caption="èƒ½è‡ªåŠ¨é”™è¯¯å›æ»šçš„ä¹è§‚ç”¨æˆ· UI"
  ratio={223/584}
/>

### å¤šä¸ª key æ•°æ®æ›´æ”¹ [#mutate-multiple-keys]

å…¨å±€ `mutate` API ç°åœ¨æ¥å—ä¸€ä¸ª `filter` å‡½æ•°ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­è¿›è¡Œç‰¹å®š key çš„æ•°æ®æ›´æ”¹æˆ–é‡æ–°éªŒè¯ã€‚è¿™å¯¹äºâ€ä½¿æ‰€æœ‰ç¼“å­˜çš„æ•°æ®å¤±æ•ˆâ€ä¹‹ç±»çš„ç”¨ä¾‹éå¸¸æœ‰å¸®åŠ©ã€‚è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥é˜…è¯»æ–‡æ¡£ä¸­çš„ [æ›´æ”¹å¤šé¡¹æ•°æ®](/docs/mutation#æ›´æ”¹å¤šé¡¹æ•°æ®)ã€‚

```jsx
import { mutate } from 'swr'
// æˆ–è€…ä» hook è·å–ï¼Œå¦‚æœä½ è‡ªå®šä¹‰äº†ä½ çš„ç¼“å­˜ providerï¼š
// { mutate } = useSWRConfig()

// å•æ•°æ®æºæ•°æ®æ›´æ”¹
mutate(key)

// æ›´æ”¹å¤šä¸ªæ•°æ®æºæ•°æ®å¹¶æ¸…é™¤ç¼“å­˜ï¼ˆè®¾ç½®ä¸º undefinedï¼‰
mutate(
  key => typeof key === 'string' && key.startsWith('/api/item?id='),
  undefined,
  { revalidate: false }
)
```

## SWR å¼€å‘è€…å·¥å…· [#swr-devtools]

[SWRDevTools](https://swr-devtools.vercel.app) æ˜¯ä¸€ä¸ªç”¨äºå¸®åŠ©ä½ è°ƒè¯•ä½ çš„ SWR ç¼“å­˜åŠè¯·æ±‚ç»“æœçš„æµè§ˆå™¨æ‹“å±•ç¨‹åºã€‚è¯·æŸ¥çœ‹æˆ‘ä»¬çš„ [devtools](/docs/advanced/devtools) æŸ¥ç»“ï¼Œäº†è§£å¦‚ä½•åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ devtoolsã€‚


![](/img/devtools/cache-view.jpg)

## é¢„åŠ è½½æ•°æ® [#preloading-data]

é¢„åŠ è½½æ•°æ®å¯ä»¥æå¤§åœ°æ”¹å–„ç”¨æˆ·ä½“éªŒã€‚å¦‚æœä½ çŸ¥é“æŸä¸ªèµ„æºç¨åå°†åœ¨åº”ç”¨ç¨‹åºè¢«ä½¿ç”¨ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨æ–°çš„ `preload` API æå‰å¼€å§‹è¯·æ±‚å®ƒï¼š

```jsx {6}
import useSWR, { preload } from 'swr'

const fetcher = (url) => fetch(url).then((res) => res.json())

// ä½ å¯ä»¥åœ¨ä»»æ„ä½ç½®è°ƒç”¨ preload å‡½æ•°
preload('/api/user', fetcher)

function Profile() {
  // å®é™…ä½¿ç”¨æ•°æ®çš„ç»„ä»¶ï¼š
  const { data, error } = useSWR('/api/user', fetcher)
  // ...
}

export function Page () {
  return <Profile/>
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ `preload` API åœ¨å…¨å±€ä½œç”¨åŸŸä¸­è¢«è°ƒç”¨ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬åœ¨ React å¼€å§‹æ¸²æŸ“ä¹‹å‰å°±å¼€å§‹é¢„åŠ è½½èµ„æºã€‚
å½“ `Profile` ç»„ä»¶è¢«æ¸²æŸ“æ—¶ï¼Œæ•°æ®å¯èƒ½å·²ç»å¯ç”¨ã€‚å¦‚æœå®ƒè¿˜åœ¨è¿›è¡Œä¸­ï¼Œ`useSWR` é’©å­å°†å¤ç”¨é‚£ä¸ªæ­£åœ¨è¿›è¡Œçš„é¢„åŠ è½½è¯·æ±‚ï¼Œè€Œä¸æ˜¯å¯åŠ¨ä¸€ä¸ªæ–°çš„è¯·æ±‚ã€‚

`preload` API ä¹Ÿå¯ä»¥ç”¨åœ¨ä¸ºå¦ä¸€ä¸ªå¯èƒ½è¢«æ¸²æŸ“çš„é¡µé¢é¢„åŠ è½½æ•°æ®çš„æƒ…å†µã€‚å…³äºä½¿ç”¨ SWR é¢„å–æ•°æ®çš„æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨[è¿™é‡Œ](/docs/refetching)æ‰¾åˆ°ã€‚

## `isLoading` [#isloading]

`isLoading` æ˜¯ `useSWR` è¿”å›çš„ä¸€ä¸ªæ–°çš„çŠ¶æ€ï¼Œå®ƒè¡¨ç¤º**è¯·æ±‚ä»åœ¨è¿›è¡Œä¸­ï¼Œå¹¶ä¸”è¿˜æ²¡æœ‰åŠ è½½æ•°æ®**ã€‚åœ¨ä¹‹å‰ï¼Œ`isValidating` çŠ¶æ€åŒæ—¶ä»£è¡¨åˆå§‹åŠ è½½çŠ¶æ€å’Œé‡æ–°éªŒè¯çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»æ£€æŸ¥ `data` å’Œ `error` æ˜¯å¦éƒ½ä¸º `undefined`ï¼Œä»¥ç¡®å®šå®ƒæ˜¯å¦ä¸ºåˆå§‹åŠ è½½çŠ¶æ€ã€‚

ç°åœ¨ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ `isLoading` çš„å€¼æ¥æ¸²æŸ“ä¸€ä¸ªåŠ è½½ä¿¡æ¯ã€‚

```jsx
import useSWR from 'swr'

function Profile() {
  const { data, isLoading } = useSWR('/api/user', fetcher)

  if (isLoading) return <div>loading...</div>
  return <div>hello {data.name}!</div>
}
```

æ³¨æ„ `isValidating` ä»ç„¶å­˜åœ¨ï¼Œæ‰€ä»¥ä½ ä¾ç„¶å¯ä»¥ç”¨å®ƒæ¥æ˜¾ç¤ºé‡æ–°éªŒè¯çš„åŠ è½½æŒ‡ç¤ºå™¨ã€‚

<Callout emoji="ğŸ“">
  æˆ‘ä»¬å¢åŠ äº†æ–°çš„ [ç†è§£ SWR](/docs/advanced/understanding) é¡µé¢æ¥æè¿° SWR å¦‚ä½•è¿”å›å€¼ï¼Œå…¶ä¸­åŒ…æ‹¬ `isValidating` å’Œ `isLoading` çš„åŒºåˆ«ï¼Œä»¥åŠå¦‚ä½•ç»“åˆå®ƒä»¬æ¥æ”¹å–„ç”¨æˆ·ä½“éªŒã€‚
</Callout>

## ä¿å­˜ä»¥å‰çš„çŠ¶æ€ [#preserving-previous-state]

æ–°å¢åŠ äº† `keepPreviousData` é€‰é¡¹ï¼Œå®ƒå…è®¸ä½ ä¿ç•™ä¹‹å‰è·å–çš„æ•°æ®ã€‚å½“ä½ æ ¹æ®å®æ—¶çš„ç”¨æˆ·æ“ä½œè·å–æ•°æ®æ—¶å¯ä»¥æå¤§åœ°æ”¹å–„ç”¨æˆ·ä½“éªŒã€‚ä¾‹å¦‚åœ¨å®æ—¶æœç´¢åŠŸèƒ½ä¸­ï¼Œèµ„æºçš„ `key' ä¼šä¸æ–­å˜åŒ–ï¼š

```jsx {5}
function Search() {
  const [search, setSearch] = React.useState('');

  const { data, isLoading } = useSWR(`/search?q=${search}`, fetcher, {
    keepPreviousData: true
  })

  return (
    <div>
      <input
        type="text"
        value={search}
        onChange={(e) => setSearch(e.target.value)}
        placeholder="Search..."
      />

      <div className={isLoading ? "loading" : ""}>
        {data?.products.map(item => <Product key={item.id} name={item.name} />)
      </div>
    </div>
  );
}
```

<Video
  src="https://user-images.githubusercontent.com/3676859/163695903-a3eb1259-180e-41e0-821e-21c320201194.mp4"
  caption="å½“å¼€å¯ keepPreviousData å°†ä¼šä¿ç•™ä¹‹å‰çš„æœç´¢ç»“æœ"
  ratio={640/730}
/>

ä½ å¯ä»¥åœ¨ [CodeSandbox](https://codesandbox.io/s/swr-keeppreviousdata-fsjz3m) ä¸ŠæŸ¥çœ‹å®Œæ•´ä»£ç ï¼Œåœ¨[è¿™é‡Œ](/docs/advanced/understanding#è¿”å›ä¹‹å‰çš„æ•°æ®ä»¥è·å¾—æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ)äº†è§£æ›´å¤šä¿¡æ¯ã€‚

## æ‰©å±•é…ç½® [#extending-configurations]

`SWRConfig` ç°åœ¨å¯ä»¥æ¥å—ä¸€ä¸ªå‡½æ•°å€¼ã€‚å½“ä½ æœ‰å¤šçº§çš„ `<SWRConfig>` æ—¶ï¼Œå†…éƒ¨ä¼šæ¥æ”¶çˆ¶çº§é…ç½®å¹¶è¿”å›ä¸€ä¸ªæ–°çš„é…ç½®ã€‚è¿™ä¸€å˜åŒ–ä½¿å¾—åœ¨å¤§å‹ä»£ç åº“ä¸­é…ç½® SWR æ›´åŠ çµæ´»ã€‚æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨[è¿™é‡Œ](/docs/global-configuration)æ‰¾åˆ°ã€‚

```jsx
<SWRConfig
  value={parentConfig => ({
    dedupingInterval: parentConfig.dedupingInterval * 5,
    refreshInterval: 100,
  })}
>
  <Page />
</SWRConfig>
```

## ä¼˜åŒ–äº†å¯¹ React 18 çš„æ”¯æŒ [#improved-react-18-support]

SWR å·²ç»æ›´æ–°äº†å…¶å†…éƒ¨ä»£ç ï¼Œä»¥ä¾¿åœ¨ React 18 ä¸­ä½¿ç”¨ `useSyncExternalStore` å’Œ `startTransition` è¿™ä¸¤ä¸ª APIã€‚è¿™ç¡®ä¿äº†åœ¨å¹¶å‘æ¸²æŸ“ UI æ—¶çš„å¼ºä¸€è‡´æ€§ã€‚è¿™ä¸€å˜åŒ–ä¸éœ€è¦ä¿®æ”¹ä»»ä½•ç”¨æˆ·ä»£ç ï¼Œæ‰€æœ‰å¼€å‘è€…éƒ½å¯ä»¥ç›´æ¥å—ç›Šã€‚

SWR 2.0 æ‰€æœ‰çš„æ–°åŠŸèƒ½ä»ç„¶å¯ä»¥ä¸ React 16 å’Œ 17 å…¼å®¹ã€‚

## è¿ç§»æŒ‡å— [#migration-guide]

### Fetcher ä¸å†æ¥å—å¤šä¸ªå‚æ•° [#fetcher-no-longer-accepts-multiple-arguments]

`key` ç°åœ¨ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„å‚æ•°ä¼ é€’

```diff
- useSWR([1, 2, 3], (a, b, c) => {
+ useSWR([1, 2, 3], ([a, b, c]) => {
  assert(a === 1)
  assert(b === 2)
  assert(c === 3)
})
```

### å…¨å±€æ•°æ®æ›´æ”¹ä¸å†æ¥å— `getKey` å‡½æ•° [#global-mutate-no-longer-accepts-a-getkey-function]

åœ¨ä¹‹å‰ï¼Œä½ å¯ä»¥å‘å…¨å±€çš„ `mutate` ä¼ é€’ä¸€ä¸ªè¿”å› key çš„å‡½æ•°ã€‚è€Œç°åœ¨ï¼Œå¦‚æœä½ å‘å…¨å±€ `mutate` ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¼šè¢«å½“ä½œä¸€ä¸ª[è¿‡æ»¤å‡½æ•°](/blog/swr-v2#å¤šä¸ªkeyæ•°æ®æ›´æ”¹)ã€‚

```diff
- mutate(() => '/api/item') // ä¸€ä¸ªè¿”å› key çš„å‡½æ•°
+ mutate('/api/item')       // ç›´æ¥ä¼ å…¥ key ä»¥æ›´æ”¹æ•°æ®
```

### Cache Interface æ–°å¢å¿…é€‰å±æ€§ `keys()` [#new-required-property-keys-for-cache-interface]

å½“ä½ ä½¿ç”¨è‡ªå·±çš„ç¼“å­˜å®ç°æ—¶ï¼ŒCache æ¥å£æ–°å¢äº†ä¸€ä¸ª `keys()` æ–¹æ³•æ¥è¿”å›ç¼“å­˜å¯¹è±¡ä¸­çš„æ‰€æœ‰ keyï¼Œç±»ä¼¼äº JavaScript çš„ Map å®ä¾‹ã€‚

```diff
interface Cache<Data> {
  get(key: string): Data | undefined
  set(key: string, value: Data): void
  delete(key: string): void
+ keys(): IterableIterator<string>
}
```

### æ”¹å˜äº†ç¼“å­˜çš„å†…éƒ¨ç»“æ„ [#changed-cache-internal-structure]

ç¼“å­˜æ•°æ®çš„å†…éƒ¨ç»“æ„å°†å˜ä¸ºä¸€ä¸ªæŒæœ‰æ‰€æœ‰å½“å‰çŠ¶æ€çš„å¯¹è±¡ã€‚

```diff
- assert(cache.get(key) === data)
+ assert(cache.get(key) === { data, error, isValidating })

// getter
- cache.get(key)
+ cache.get(key)?.data

// setter
- cache.set(key, data)
+ cache.set(key, { ...cache.get(key), data })
```

<Callout emoji="ğŸš¨" type="error">
  ä½ ä¸åº”è¯¥ç›´æ¥å†™å…¥ç¼“å­˜ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚
</Callout>

### `SWRConfig.default` é‡å‘½åä¸º `SWRConfig.defaultValue` [#swrconfigdefault-is-renamed-as-swrconfigdefaultvalue]

`SWRConfig.defaultValue` æ˜¯ä¸€ä¸ªç”¨äºè·å–é»˜è®¤ SWR é…ç½®çš„å±æ€§

```diff
- SWRConfig.default
+ SWRConfig.defaultValue
```

### Type `InfiniteFetcher` é‡å‘½åä¸º `SWRInfiniteFetcher` [#type-infinitefetcher-is-renamed-as-swrinfinitefetcher]

```diff
- import type { InfiniteFetcher } from 'swr/infinite'
+ import type { SWRInfiniteFetcher } from 'swr/infinite'
```

### é¿å…åœ¨æœåŠ¡ç«¯ä½¿ç”¨ Suspense [#avoid-suspense-on-server]

å¦‚æœä½ æƒ³è¦åœ¨æœåŠ¡ç«¯ä½¿ç”¨ SWR `suspense: true`ï¼ŒåŒ…æ‹¬ Next.js çš„é¢„æ¸²æŸ“ï¼Œé‚£ä¹ˆä½ å¿…é¡»é€šè¿‡ [`fallbackData` æˆ– `fallback`](/docs/with-nextjs#pre-rendering-with-default-data) æä¾›åˆå§‹æ•°æ®ã€‚ä»Šå¤©è¿™æ„å‘³ç€ä½ ä¸èƒ½åœ¨æœåŠ¡ç«¯ä½¿ç”¨ Susense è·å–æ•°æ®äº†ã€‚ä½ çš„å¦å¤–ä¸¤ç§é€‰åˆ™æ˜¯å®Œå…¨åœ¨å®¢æˆ·ç«¯è·å–æ•°æ®ï¼Œæˆ–è€…ä½¿ç”¨æ¡†æ¶è·å–æ•°æ®(å°±åƒ Next.js ä¸­çš„ getStaticProps é‚£æ ·)ã€‚

### ä»¥ ES2018 ä¸ºæ„å»ºç›®æ ‡ [#es2018-as-the-build-target]

å¦‚æœä½ æƒ³æ”¯æŒ IE 11ï¼Œä½ å¿…é¡»åœ¨ä½ çš„æ¡†æ¶æˆ– bundler æŒ‡å®šæ„å»ºç›®æ ‡ä¸º ES5ã€‚è¿™ä¸€å˜åŒ–ä½¿ SSR çš„æ€§èƒ½å¾—åˆ°äº†ä¼˜åŒ–ï¼Œå¹¶ä½¿æ„å»ºäº§ç‰©çš„ä½“ç§¯å˜å°ã€‚


## æ›´æ–°æ—¥å¿— [#changelog]

åœ¨ [GitHub](https://github.com/vercel/swr/releases) æŸ¥çœ‹å®Œæ•´æ—¥å¿—ã€‚

## å±•æœ›æœªæ¥ & è‡´è°¢ï¼ [#the-future--thank-you]

éšç€ [Next.js 13](https://nextjs.org/blog/next-13) çš„æ–°å‘å¸ƒ ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¾ˆå¤šä»¤äººå…´å¥‹çš„æ–°ç‰¹æ€§å’Œ React ç”Ÿæ€ç³»ç»Ÿä¸­çš„èŒƒå¼è½¬å˜ï¼š[React Server Components](https://beta.nextjs.org/docs/rendering/server-and-client-components)ï¼Œstreaming SSRï¼Œ[async components](https://beta.nextjs.org/docs/data-fetching/fetching#asyncawait-in-server-components)ï¼Œä»¥åŠ [`use` hook](https://github.com/acdlite/rfcs/blob/first-class-promises/text/0000-first-class-support-for-promises.md#usepromise) ã€‚å…¶ä¸­è®¸å¤šéƒ½ä¸æ•°æ®è·å–æœ‰å…³ï¼Œæœ‰ä¸€éƒ¨åˆ†ä¸ SWR æœ‰ç€ç›¸åŒçš„ä½¿ç”¨åœºæ™¯ã€‚

ç„¶è€Œ SWR é¡¹ç›®çš„ç›®æ ‡ä»ç„¶ä¸å˜ã€‚æˆ‘ä»¬å¸Œæœ›å®ƒæˆä¸ºä¸€ä¸ªè½»é‡çº§çš„ã€æ¡†æ¶æ— å…³çš„ã€æœ‰ä¸€ç‚¹ _å›ºæ‰§_ï¼ˆä¾‹å¦‚ï¼šèšç„¦æ—¶é‡æ–°éªŒè¯ï¼‰çš„è½åœ°åº“ã€‚æˆ‘ä»¬ä¸æƒ³æˆä¸ºä¸€ä¸ªæ ‡å‡†çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯æƒ³ä¸“æ³¨äºåˆ›æ–°ï¼Œä½¿ç”¨æˆ·ä½“éªŒå˜å¾—æ›´å¥½ã€‚åŒæ—¶æˆ‘ä»¬ä¹Ÿåœ¨ç ”ç©¶å¦‚ä½•åˆ©ç”¨ React çš„è¿™äº›æ–°èƒ½åŠ›æ¥æ”¹è¿› SWRã€‚

æˆ‘ä»¬è¦æ„Ÿè°¢ [143](https://github.com/vercel/swr/graphs/contributors) è´¡çŒ®è€…ï¼ˆ+[106](https://github.com/vercel/swr-site/graphs/contributors) æ–‡æ¡£è´¡çŒ®è€…ï¼‰ä¸­çš„æ¯ä¸€ä½ï¼Œä»¥åŠé‚£äº›ç»™æˆ‘ä»¬æä¾›å¸®åŠ©æˆ–åé¦ˆçš„äººã€‚ç‰¹åˆ«æ„Ÿè°¢ [Toru Kobayashi](https://twitter.com/koba04) åœ¨ DevTools å’Œæ–‡æ¡£æ–¹é¢æ‰€åšçš„å·¥ä½œ--æ²¡æœ‰ä½ ï¼Œæˆ‘ä»¬ä¸å¯èƒ½åšåˆ°è¿™ä¸€ç‚¹!