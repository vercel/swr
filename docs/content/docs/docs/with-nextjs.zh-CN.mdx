import { Callout } from 'nextra-theme-docs'

# ä¸ Next.js ä¸€åŒä½¿ç”¨

## App Router [#app-dir]

### Server Components [#rsc]

<Callout type="default" emoji="âœ…">
   åœ¨ Next.js App Router ä¸­ï¼Œæ‰€æœ‰çš„ç»„ä»¶éƒ½è¢«é»˜è®¤è§†ä¸º React Server Components (RSC) ã€‚**åœ¨ RSC ä¸­æ‚¨åªèƒ½ ä»SWR å¼•å…¥åºåˆ—åŒ– Key API**
</Callout>

```tsx filename="app/page.tsx" copy
import { unstable_serialize } from 'swr' // âœ… åœ¨ Server components ä¸­å¯ç”¨
import { unstable_serialize as infinite_unstable_serialize } from 'swr/infinite' // âœ… åœ¨ Server components ä¸­å¯ç”¨
```

<Callout type="error">
   æ‚¨ä¸èƒ½ä» SWR å¼•å…¥å…¶ä»– API ï¼Œå› ä¸ºå®ƒä»¬åœ¨ RSC ä¸­ä¸å¯ç”¨ã€‚
</Callout>

```tsx filename="app/page.tsx" highlight={1}
import useSWR from 'swr' // âŒ åœ¨ Server components ä¸­ä¸å¯ç”¨
```

### Client Components

æ‚¨å¯ä»¥ç›´æ¥ç”¨ `'use client'` æ ‡è®°æ‚¨çš„ç»„ä»¶æˆ–è€…ä» Client Components å¼•å…¥ SWR ï¼Œä¸¤ç§æ–¹æ³•éƒ½å…è®¸æ‚¨ä½¿ç”¨ SWR æä¾›çš„å®¢æˆ·ç«¯æ•°æ®è·å– Hooksã€‚

```tsx filename="app/page.tsx" highlight={1} copy
'use client'
import useSWR from 'swr'
export default function Page() {
  const { data } = useSWR('/api/user', fetcher)
  return <h1>{data.name}</h1>
}
```

å¦‚æœæ‚¨éœ€è¦åœ¨ Server Components `layout` æˆ–è€… `page` ä¸­ä½¿ç”¨ `SWRConfig` é…ç½®å…¬å…±è®¾ç½®ï¼Œè¯·åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ Provider Client Component ä»¥åˆå§‹åŒ– Provider å’Œé…ç½®ï¼Œç„¶ååœ¨ Server Component Pages ä¸­ä½¿ç”¨å®ƒã€‚

```tsx filename="app/swr-provider.tsx" copy
'use client';
import { SWRConfig } from 'swr'
export const SWRProvider = ({ children }) => {
  return <SWRConfig>{children}</SWRConfig>
};
```

```tsx filename="app/page.tsx" copy
// è¿™ä»ç„¶æ˜¯ä¸€ä¸ª Server Component
import { SWRProvider } from './swr-provider'
export default function Page() {
  return (
    <SWRProvider>
      <h1>hello SWR</h1>
    </SWRProvider>
  )
}
```

## å®¢æˆ·ç«¯æ•°æ®è·å– [#client-side-data-fetching]

å¦‚æœæ‚¨çš„é¡µé¢åŒ…å«ä¸€äº›é¢‘ç¹æ›´æ–°çš„æ•°æ®ï¼Œè€Œæ‚¨å¹¶ä¸éœ€è¦é¢„æ¸²æŸ“è¿™äº›æ•°æ®ï¼ŒSWR å°†éå¸¸é€‚ç”¨å¹¶ä¸”å¹¶ä¸éœ€è¦ç‰¹æ®Šçš„é…ç½®ï¼šåªéœ€è¦å¼•å…¥ `useSWR` ç„¶ååœ¨ä»»ä½•éœ€è¦ä½¿ç”¨æ•°æ®çš„ç»„ä»¶ä¸­ä½¿ç”¨è¿™ä¸ª Hook

ä»¥ä¸‹æ˜¯å®ƒçš„å·¥ä½œæ–¹å¼ï¼š

- é¦–å…ˆï¼Œç«‹å³åœ¨æ²¡æœ‰æ•°æ®çš„æƒ…å†µä¸‹å±•ç¤ºé¡µé¢ã€‚æ‚¨å¯ä»¥æ˜¾ç¤ºç¼ºå¤±æ•°æ®çš„åŠ è½½çŠ¶å†µã€‚
- ç„¶åï¼Œåœ¨å®¢æˆ·ç«¯è·å–æ•°æ®ï¼Œå¹¶åœ¨æ•°æ®å‡†å¤‡å¥½æ—¶å±•ç¤ºå®ƒä»¬.

ä¾‹å¦‚ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨ç”¨æˆ·ä»ªè¡¨ç›˜é¡µé¢ä¸Šå·¥ä½œå¾—å¾ˆå¥½ã€‚å› ä¸ºä»ªè¡¨æ¿æ˜¯ä¸å…¬å¼€ã€ç”¨æˆ·ç‰¹å®šçš„é¡µé¢ï¼Œä¸ SEO æ— å…³å¹¶ä¸”é¡µé¢ä¸éœ€è¦é¢„æ¸²æŸ“ã€‚æ•°æ®é¢‘ç¹æ›´æ–°ï¼Œéœ€è¦åœ¨è¯·æ±‚æ—¶è·å–ã€‚

## å¸¦æœ‰é»˜è®¤æ•°æ®çš„é¢„æ¸²æŸ“ [#pre-rendering-with-default-data]

å¦‚æœé¡µé¢éœ€è¦é¢„æ¸²æŸ“ï¼ŒNext.js æ”¯æŒ [ä¸¤ç§é¢„æ¸²æŸ“æ–¹å¼](https://nextjs.org/docs/basic-features/data-fetching):
**é™æ€ç”Ÿæˆ (SSG)** and **æœåŠ¡ç«¯æ¸²æŸ“ (SSR)**.

é€šè¿‡ä½¿ç”¨ SWR, æ‚¨å¯ä»¥ä¸ºäº† SEO é¢„æ¸²æŸ“é¡µé¢, å¹¶åŒæ—¶åœ¨å®¢æˆ·ç«¯äº«å—ç¼“å­˜ã€é‡æ–°éªŒè¯ã€ç„¦ç‚¹è¿½è¸ªã€å®šæ—¶é‡æ–°è·å–ç­‰ç‰¹æ€§ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨ [`SWRConfig`](/docs/global-configuration) çš„ `fallback` é€‰é¡¹æ¥å°†é¢„è·å–çš„æ•°æ®ä½œä¸ºæ‰€æœ‰ SWR Hook çš„åˆå§‹å€¼ã€‚

ä½¿ç”¨ `getStaticProps` çš„ä¾‹å­ï¼š

```jsx
 export async function getStaticProps () {
  // `getStaticProps` åœ¨æœåŠ¡ç«¯æ‰§è¡Œ
  const article = await getArticleFromAPI()
  return {
    props: {
      fallback: {
        '/api/article': article
      }
    }
  }
}

function Article() {
  // `data` å°†å§‹ç»ˆå¯ç”¨ï¼Œå› ä¸ºå…¶å¤„äº `fallback` åˆ—è¡¨ä¸­
  const { data } = useSWR('/api/article', fetcher)
  return <h1>{data.title}</h1>
}

export default function Page({ fallback }) {
  // åœ¨ `SWRConfig` æ ‡ç­¾å†…çš„ SWR hooks å°†ä½¿ç”¨è¿™äº›å€¼
  return (
    <SWRConfig value={{ fallback }}>
      <Article />
    </SWRConfig>
  )
}
```

è¯¥é¡µé¢ä»ç„¶æ˜¯é¢„å…ˆç”Ÿæˆï¼ŒSEO å‹å¥½çš„ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¿«é€Ÿååº”ã€‚ç„¶è€Œè¯¥é¡µé¢åœ¨å®¢æˆ·ç«¯ä¾§ä»ç„¶å®Œå…¨ç”± SWR é©±åŠ¨ã€‚æ•°æ®ä»ç„¶æ˜¯åŠ¨æ€çš„ï¼Œä¸”å¯ä»¥è‡ªåŠ¨æ›´æ–°ã€‚

<Callout emoji="ğŸ’¡">
  `Article` ç»„ä»¶å°†å…ˆæ¸²æŸ“é¢„å…ˆç”Ÿæˆçš„æ•°æ®ï¼Œå¹¶ä¸”åœ¨é¡µé¢æ°´åˆå®Œæˆåå°†å†æ¬¡è·å–æœ€æ–°æ•°æ®ä»¥ä¿æŒæ•°æ®æœ€æ–°
</Callout>

### å¤æ‚å…³é”®å­— [#complex-keys]

`useSWR` å¯ä»¥ä¸ `array` å’Œ `function` ç±»å‹çš„ key ä¸€åŒä½¿ç”¨. è‹¥è¦é€šè¿‡è¿™äº›ç±»å‹çš„ key ä½¿ç”¨é¢„å…ˆè·å–çš„æ•°æ®ï¼Œéœ€è¦ç”¨ `unstable_serialize` åºåˆ—åŒ– `fallback` key.

```jsx
import useSWR, { unstable_serialize } from 'swr'

export async function getStaticProps () {
  const article = await getArticleFromAPI(1)
  return {
    props: {
      fallback: {
        // unstable_serialize() array style key
        [unstable_serialize(['api', 'article', 1])]: article,
      }
    }
  }
}

function Article() {
  // using an array style key.
  const { data } = useSWR(['api', 'article', 1], fetcher)
  return <h1>{data.title}</h1>
}

export default function Page({ fallback }) {
  return (
    <SWRConfig value={{ fallback }}>
      <Article />
    </SWRConfig>
  )
}
```
