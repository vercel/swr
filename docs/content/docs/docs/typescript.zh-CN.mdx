# TypeScript

SWR å¯¹äºä½¿ç”¨ TypeScript ç¼–å†™çš„ app æ˜¯å‹å¥½çš„ï¼Œå¼€ç®±å³ç”¨ï¼Œç±»å‹å®‰å…¨ã€‚

## åŸºæœ¬ç”¨æ³• [#basic-usage]

é»˜è®¤æƒ…å†µä¸‹ï¼ŒSWR ä¼šä» `key` æ¨æ–­å‡º `fetcher` çš„å‚æ•°ç±»å‹ï¼Œå› æ­¤ä½ å¯ä»¥è‡ªåŠ¨è·å¾—é¦–é€‰ç±»å‹ã€‚

### useSWR [#useswr]

```typescript
// `key` è¢«æ¨æ–­ä¸º `string`
useSWR('/api/user', key => {})
useSWR(() => '/api/user', key => {})

// `key` å°†è¢«æ¨æ–­ä¸º { a: string; b: { c: string; d: number } }
useSWR({ a: '1', b: { c: '3', d: 2 } }, key => {})
useSWR(() => ({ a: '1', b: { c: '3', d: 2 } }), key => {})

// `arg0` å°†è¢«æ¨æ–­ä¸º string.  `arg1` å°†è¢«æ¨æ–­ä¸º number
useSWR(['user', 8], ([arg0, arg1]) => {})
useSWR(() => ['user', 8], ([arg0, arg1]) => {})
```

ä½ è¿˜å¯ä»¥æ˜¾å¼åœ°æŒ‡å®š `key` å’Œ `fetcher` å‚æ•°çš„ç±»å‹ã€‚

```typescript
import useSWR, { Fetcher } from 'swr'

const uid = '<user_id>'
const fetcher: Fetcher<User, string> = (id) => getUserById(id)

const { data } = useSWR(uid, fetcher)
// `data` å°†ä¼šæ˜¯ `User | undefined`.
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨ `fetcher` å‡½æ•°å†…éƒ¨[æŠ›å‡ºçš„é”™è¯¯](/docs/error-handling)å…·æœ‰ `any` ç±»å‹ã€‚è¯¥ç±»å‹ä¹Ÿå¯ä»¥æ˜ç¡®æŒ‡å®šã€‚

```typescript
const { data, error } = useSWR<User, Error>(uid, fetcher);
// `data` å°†ä¼šæ˜¯ `User | undefined`.
// `error` å°†ä¼šæ˜¯ `Error | undefined`.
```

### useSWRInfinite [#useswrinfinite]

åŒæ ·é€‚ç”¨äº `swr/infinite`ï¼Œä½ å¯ä»¥ä¾é è‡ªåŠ¨ç±»å‹æ¨æ–­æˆ–è‡ªå·±æ˜¾å¼åœ°æŒ‡å®šç±»å‹ã€‚

```typescript
import { SWRInfiniteKeyLoader } from 'swr/infinite'

const getKey: SWRInfiniteKeyLoader = (index, previousPageData) => {
  // ...
}

const { data } = useSWRInfinite(getKey, fetcher)
```

### useSWRSubscription [#useswrsubscription]

* å†…è”çš„ `subscribe` å‡½æ•°ï¼Œæ‰‹åŠ¨æŒ‡å®š `next` ç±»å‹ä¸º `SWRSubscriptionOptions` çš„ç¤ºä¾‹ä»£ç ï¼š

```tsx
import useSWRSubscription from 'swr/subscription'
import type { SWRSubscriptionOptions } from 'swr/subscription'

const { data, error } = useSWRSubscription('key', 
  (key, { next }: SWRSubscriptionOptions<number, Error>) => {
  //^ key å°†ä¼šè¢«æ¨å¯¼ä¸º `string`
  //....
  })
  return {
    data,
    //^ data å°†ä¼šè¢«æ¨å¯¼ä¸º as `number | undefined`
    error
    //^ error å°†ä¼šè¢«æ¨å¯¼ä¸º as `Error | undefined`
  }
}
```

* ä½¿ç”¨ `SWRSubscription` å£°æ˜ `subscribe` å‡½æ•°çš„ç¤ºä¾‹ä»£ç ï¼š

```tsx
import useSWRSubscription from 'swr/subscription'
import type { SWRSubscription } from 'swr/subscription'

/** 
 * ç¬¬ä¸€ä¸ªæ³›å‹æ˜¯ Key
 * ç¬¬äºŒä¸ªæ³›å‹æ˜¯ Data
 * ç¬¬ä¸‰ä¸ªæ³›å‹æ˜¯ Error
 */
const sub: SWRSubscription<string, number, Error> = (key, { next }) => {                         
  //......
}
const { data, error } = useSWRSubscription('key', sub)
```

## æ³›å‹ [#generics]

æŒ‡å®š `data` çš„ç±»å‹å¾ˆå®¹æ˜“ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†ä½¿ç”¨ `fetcher` çš„è¿”å›ç±»å‹ï¼ˆæœªå°±ç»ªçŠ¶æ€ä¸º `undefined`ï¼‰ä½œä¸º `data` çš„ç±»å‹ï¼Œä½†ä½ ä¹Ÿå¯ä»¥å°†å…¶ä½œä¸ºå‚æ•°ä¼ é€’ï¼š

```typescript
// ğŸ”¹ A. ä½¿ç”¨ä¸€ä¸ªæœ‰ç±»å‹çš„ fetcher:
// `getUser` æ˜¯ `(endpoint: string) => User`.
const { data } = useSWR('/api/user', getUser)

// ğŸ”¹ B. æŒ‡å®š data ç±»å‹:
// `fetcher` ä¸€èˆ¬ä¼šè¿”å› `any`.
const { data } = useSWR<User>('/api/user', fetcher)
```

å¦‚æœè¦ä¸º SWR çš„å…¶ä»–é€‰é¡¹æ·»åŠ ç±»å‹ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥å¯¼å…¥è¿™äº›ç±»å‹ï¼š

```typescript
import useSWR from 'swr'
import type { SWRConfiguration } from 'swr'

const config: SWRConfiguration = {
  fallbackData: "fallback",
  revalidateOnMount: false
  // ...
}

const { data } = useSWR<string[]>('/api/data', fetcher, config)
```

## ä¸­é—´ä»¶ç±»å‹ [#middleware-types]

ä½ å¯ä»¥å¯¼å…¥ä¸€äº›é¢å¤–çš„ç±»å‹å®šä¹‰ï¼Œä»¥å¸®åŠ©ä½ å‘è‡ªå®šä¹‰çš„ä¸­é—´ä»¶æ·»åŠ ç±»å‹ã€‚

```typescript
import useSWR, { Middleware, SWRHook } from 'swr'

const swrMiddleware: Middleware = (useSWRNext: SWRHook) => (key, fetcher, config) => {
  // ...
  return useSWRNext(key, fetcher, config)
}
```
