import { Callout, Tabs, Tab } from 'nextra-theme-docs';
import Link from "next/link";

# å…¥é—¨

## å®‰è£… [#installation]

åœ¨ React é¡¹ç›®ç›®å½•è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

<Tabs items={['pnpm', 'npm', 'yarn']}>
  <Tab>
    ```bash
    pnpm add swr
    ```
  </Tab>
  <Tab>
    ```bash
    npm i swr
    ```
  </Tab>
  <Tab>
    ```bash
    yarn add swr
    ```
  </Tab>
</Tabs>

## å¿«é€Ÿå¼€å§‹ [#quick-start]

å¯¹äºè¿”å› JSON æ•°æ®çš„æ™®é€š RESTful APIsï¼Œé¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ª `fetcher` å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åªæ˜¯åŸç”Ÿ `fetch` çš„åŒ…è£…ï¼š

```jsx
const fetcher = (...args) => fetch(...args).then((res) => res.json())
```

<Callout emoji="ğŸ’¡">
  å¦‚æœè¦ä½¿ç”¨ GraphQL API æˆ–ç±»ä¼¼ Axios çš„åº“ï¼Œå¯ä»¥è‡ªå·±åˆ›å»º fetcher å‡½æ•°ã€‚ ç‚¹å‡» <Link href="/docs/data-fetching">è¿™é‡Œ</Link> æŸ¥çœ‹æ›´å¤šç¤ºä¾‹ã€‚
</Callout>

ç„¶åä½ å¯ä»¥ import `useSWR` å¹¶å¼€å§‹åœ¨ä»»ä½•å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨å®ƒï¼š

```jsx
import useSWR from "swr";

function Profile ({ userId }) {
  const { data, error, isLoading } = useSWR(`/api/user/${userId}`, fetcher)

  if (error) return <div>failed to load</div>
  if (isLoading) return <div>loading...</div>

  // æ¸²æŸ“æ•°æ®
  return <div>hello {data.name}!</div>
}
```

é€šå¸¸ï¼Œä¸€ä¸ªè¯·æ±‚æœ‰ 3 ç§å¯èƒ½çš„çŠ¶æ€ï¼šâ€œloadingâ€ã€â€œreadyâ€æˆ–â€œerrorâ€ã€‚ä½ å¯ä»¥ä½¿ç”¨ `data`ã€`error` å’Œ `isLoading` çš„å€¼æ¥ç¡®å®šå½“å‰çš„è¯·æ±‚çŠ¶æ€ï¼Œå¹¶è¿”å›ç›¸åº”çš„ UIã€‚

## å¯å¤ç”¨ç»„ä»¶ [#make-it-reusable]

åœ¨æ„å»º web åº”ç”¨æ—¶ï¼Œä½ å¯èƒ½éœ€è¦åœ¨ UI çš„å¾ˆå¤šåœ°æ–¹é‡ç”¨æ•°æ®ã€‚åœ¨ SWR ä¸Šåˆ›å»ºå¯é‡ç”¨çš„æ•°æ® hooks éå¸¸å®¹æ˜“ï¼š

```jsx
function useUser(id) {
  const { data, error, isLoading } = useSWR(`/api/user/${id}`, fetcher)

  return {
    user: data,
    isLoading,
    isError: error,
  }
}
```

åœ¨ç»„ä»¶ä¸­ä½¿ç”¨å®ƒï¼š

```jsx
function Avatar({ id }) {
  const { user, isLoading, isError } = useUser(id)

  if (isLoading) return <Spinner />
  if (isError) return <Error />
  return <img src={user.avatar} />
}
```

é€šè¿‡é‡‡ç”¨è¿™ç§æ¨¡å¼ï¼Œä½ å¯ä»¥ä¸å¿…ä»¥å‘½ä»¤çš„æ–¹å¼**è¯·æ±‚**æ•°æ®ï¼šå¼€å§‹è¯·æ±‚ã€æ›´æ–°åŠ è½½çŠ¶æ€å¹¶è¿”å›æœ€ç»ˆç»“æœã€‚ ç›¸åï¼Œä½ çš„ä»£ç æ›´å…·æœ‰å£°æ˜æ€§ï¼šä½ åªéœ€è¦æŒ‡å®šç»„ä»¶ä½¿ç”¨ä»€ä¹ˆæ•°æ®å³å¯ã€‚

## ç¤ºä¾‹ [#example]

åœ¨ä¸€ä¸ªçœŸå®çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬çš„ç½‘ç«™æ˜¾ç¤ºä¸€ä¸ªå¯¼èˆªæ¡å’Œå†…å®¹ï¼Œéƒ½å–å†³äº `user`ï¼š

import { Welcome } from 'components/diagrams/welcome'

<div className="mt-8">
  <Welcome/>
</div>

ä¼ ç»Ÿä¸Šï¼Œæˆ‘ä»¬åœ¨é¡¶çº§ç»„ä»¶ä¸­ä½¿ç”¨ `useEffect` è¯·æ±‚ä¸€æ¬¡æ•°æ®ï¼Œç„¶åé€šè¿‡ props å°†å…¶ä¼ é€’ç»™å­ç»„ä»¶ï¼ˆæ³¨æ„ï¼Œæˆ‘ä»¬ç°åœ¨ä¸å¤„ç†é”™è¯¯çŠ¶æ€ï¼‰ï¼š

```jsx {7-11,17,18,27}
// é¡µé¢ç»„ä»¶

function Page ({ userId }) {
  const [user, setUser] = useState(null)

  // è¯·æ±‚æ•°æ®
  useEffect(() => {
    fetch(`/api/user/${userId}`)
      .then(res => res.json())
      .then(data => setUser(data))
  }, [userId])

  // å…¨å±€åŠ è½½çŠ¶æ€
  if (!user) return <Spinner />

  return <div>
    <Navbar user={user} />
    <Content user={user} />
  </div>
}

// å­ç»„ä»¶

function Navbar({ user }) {
  return <div>
    ...
    <Avatar user={user} />
  </div>
}

function Content({ user }) {
  return <h1>Welcome back, {user.name}</h1>
}

function Avatar({ user }) {
  return <img src={user.avatar} alt={user.name} />
}
```

é€šå¸¸ï¼Œæˆ‘ä»¬éœ€è¦å°†æ‰€æœ‰çš„æ•°æ®è¯·æ±‚éƒ½ä¿å­˜åœ¨é¡¶çº§ç»„ä»¶ä¸­ï¼Œå¹¶ä¸ºæ ‘æ·±å¤„çš„æ¯ä¸ªç»„ä»¶æ·»åŠ  propsã€‚å¦‚æœæˆ‘ä»¬ç»™é¡µé¢æ·»åŠ æ›´å¤šçš„æ•°æ®ä¾èµ–ï¼Œä»£ç å°†å˜å¾—æ›´åŠ éš¾ä»¥ç»´æŠ¤ã€‚

è™½ç„¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [Context](https://react.dev/learn/passing-data-deeply-with-context) æ¥é¿å…ä¼ é€’ propsï¼Œä½†ä»ç„¶å­˜åœ¨åŠ¨æ€å†…å®¹é—®é¢˜ï¼šé¡µé¢å†…å®¹ä¸­çš„ç»„ä»¶å¯ä»¥æ˜¯åŠ¨æ€çš„ï¼Œé¡¶çº§ç»„ä»¶å¯èƒ½ä¸çŸ¥é“å…¶å­ç»„ä»¶å°†éœ€è¦ä»€ä¹ˆæ•°æ®ã€‚

SWR å®Œç¾åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ä½¿ç”¨æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ `useUser` hookï¼Œå¯ä»¥å°†ä»£ç é‡æ„ä¸º:

```jsx {20,26}
// é¡µé¢ç»„ä»¶

function Page ({ userId }) {
  return <div>
    <Navbar userId={userId} />
    <Content userId={userId} />
  </div>
}

// å­ç»„ä»¶

function Navbar ({ userId }) {
  return <div>
    ...
    <Avatar userId={userId} />
  </div>
}

function Content ({ userId }) {
  const { user, isLoading } = useUser(userId)
  if (isLoading) return <Spinner />
  return <h1>Welcome back, {user.name}</h1>
}

function Avatar ({ userId }) {
  const { user, isLoading } = useUser(userId)
  if (isLoading) return <Spinner />
  return <img src={user.avatar} alt={user.name} />
}
```

ç°åœ¨æ•°æ®å·² **ç»‘å®š** åˆ°éœ€è¦è¯¥æ•°æ®çš„ç»„ä»¶ä¸Šï¼Œå¹¶ä¸”æ‰€æœ‰ç»„ä»¶éƒ½æ˜¯ç›¸äº’ **ç‹¬ç«‹** çš„ã€‚æ‰€æœ‰çš„çˆ¶ç»„ä»¶éƒ½ä¸éœ€è¦å…³å¿ƒå…³äºæ•°æ®æˆ–æ•°æ®ä¼ é€’çš„ä»»ä½•ä¿¡æ¯ã€‚å®ƒä»¬åªæ˜¯æ¸²æŸ“ã€‚ç°åœ¨ä»£ç æ›´ç®€å•ï¼Œæ›´æ˜“äºç»´æŠ¤äº†ã€‚

æœ€æ£’çš„æ˜¯ï¼Œåªä¼šæœ‰ **1 ä¸ªè¯·æ±‚** å‘é€åˆ° APIï¼Œå› ä¸ºå®ƒä»¬ä½¿ç”¨ç›¸åŒçš„ SWR keyï¼Œå› æ­¤è¯·æ±‚ä¼šè¢«è‡ªåŠ¨ **å»é™¤é‡å¤**ã€**ç¼“å­˜** å’Œ **å…±äº«**ã€‚

è€Œä¸”ï¼Œä½ çš„åº”ç”¨ç°åœ¨èƒ½å¤Ÿåœ¨ [ç”¨æˆ·èšç„¦æˆ–ç½‘ç»œé‡è¿](/docs/revalidation) æ—¶é‡æ–°è¯·æ±‚æ•°æ®ï¼è¿™æ„å‘³ç€å½“ç”¨æˆ·çš„ç¬”è®°æœ¬ç”µè„‘ä»ç¡çœ çŠ¶æ€å”¤é†’ï¼Œæˆ–ç”¨æˆ·åœ¨åˆ‡æ¢æµè§ˆå™¨æ ‡ç­¾é¡µæ—¶ï¼Œæ•°æ®å°†è‡ªåŠ¨åˆ·æ–°ã€‚
