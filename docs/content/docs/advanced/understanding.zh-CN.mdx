---
title: 'ç†è§£ SWR'
---

## çŠ¶æ€æœºåˆ¶ [#state-machine]

`useSWR` ä¼šæ ¹æ® `fetcher` å‡½æ•°çš„çŠ¶æ€è¿”å› `data`ï¼Œ`error`ï¼Œ`isLoading` å’Œ `isValidating`ã€‚ä»¥ä¸‹è¿™äº›å›¾ç‰‡æè¿°äº† SWR åœ¨ä¸åŒæƒ…å†µä¸‹æ˜¯å¦‚ä½•è¿”å›å€¼çš„ã€‚

### è¯·æ±‚ä¸é‡æ–°è¯·æ±‚ [#fetch-and-revalidate]

è¿™ç§æ¨¡å¼è¡¨ç¤ºè¯·æ±‚æ•°æ®ï¼Œå¹¶åœ¨ä¹‹åé‡æ–°è¯·æ±‚çš„åœºæ™¯ã€‚

![A pattern for fetch and revalidate](/img/understanding/fetch-and-revalidate.svg)

### Key çš„å˜åŒ– [#key-change]

è¿™ç§æ¨¡å¼è¡¨ç¤ºåœ¨è¯·æ±‚æ•°æ®ï¼Œå†æ”¹å˜ key å€¼ï¼Œå¹¶åœ¨ä¹‹åé‡æ–°è¯·æ±‚çš„åœºæ™¯ã€‚

![A pattern for key change](/img/understanding/key-change.svg)

### Key çš„å˜åŒ– + ä¿ç•™ä¹‹å‰çš„æ•°æ® [#key-change--previous-data]

è¿™ç§æ¨¡å¼è¡¨ç¤ºåœ¨å¼€å¯ `keepPreviousData` é€‰é¡¹æ—¶ï¼Œè¯·æ±‚æ•°æ®ï¼Œå†æ”¹å˜ key å€¼ï¼Œå¹¶åœ¨ä¹‹åé‡æ–°è¯·æ±‚çš„åœºæ™¯ã€‚

![A pattern for key change + previous data](/img/understanding/key-change-previous-data.svg)

### è®¾ç½®é¢„è®¾æ•°æ® [#fallback]

è¿™ç§æ¨¡å¼è¡¨ç¤ºè®¾ç½®äº†é¢„è®¾æ•°æ®æ—¶ï¼Œè¯·æ±‚æ•°æ®ï¼Œå¹¶åœ¨ä¹‹åè¿›è¡Œé‡æ–°è¯·æ±‚çš„åœºæ™¯ã€‚

![A pattern for fallback](/img/understanding/fallback.svg)

### Key çš„å˜åŒ– + è®¾ç½®é¢„è®¾æ•°æ® [#key-change--fallback]

è¿™ç§æ¨¡å¼è¡¨ç¤ºåœ¨è®¾ç½®é¢„è®¾æ•°æ®æ—¶ï¼Œè¯·æ±‚æ•°æ®ï¼Œå†æ”¹å˜ key å€¼ï¼Œå¹¶åœ¨ä¹‹åè¿›è¡Œé‡æ–°è¯·æ±‚çš„åœºæ™¯ã€‚

![A pattern for key change + fallback](/img/understanding/key-change-fallback.svg)

### Key çš„å˜åŒ– + ä¿ç•™ä¹‹å‰çš„æ•°æ® + è®¾ç½®é¢„è®¾æ•°æ® [#key-change--previous-data--fallback]

è¿™ç§æ¨¡å¼è¡¨ç¤ºåœ¨å¼€å¯ `keepPreviousData` é€‰é¡¹å¹¶è®¾ç½®é¢„è®¾æ•°æ®æ—¶ï¼Œè¯·æ±‚æ•°æ®ï¼Œå†æ”¹å˜ key å€¼ï¼Œå¹¶åœ¨ä¹‹åè¿›è¡Œé‡æ–°è¯·æ±‚çš„åœºæ™¯ã€‚

![A pattern for key change + previous data + fallback](/img/understanding/key-change-previous-data-fallback.svg)

## ç»“åˆ `isLoading` å’Œ `isValidating` ä»¥è·å¾—æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ [#combining-with-isloading-and-isvalidating-for-better-ux]

ç›¸æ¯”äºç°æœ‰çš„ `isValidating` ï¼Œ`isLoading` æ˜¯ä¸€ä¸ªæ–°çš„å±æ€§ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬åº”å¯¹æ›´åŠ æ™®éçš„ç”¨æˆ·åŠ è½½åœºæ™¯ã€‚

- æ— è®ºæ•°æ®æ˜¯å¦å·²åŠ è½½ï¼Œåªè¦æœ‰ä¸€ä¸ªæ­£åœ¨è¿›è¡Œä¸­çš„è¯·æ±‚ï¼Œ`isValidating` éƒ½ä¼šå˜ä¸º `true` ã€‚
- å½“æ•°æ®å°šæœªåŠ è½½å¹¶ä¸”æœ‰ä¸€ä¸ªæ­£åœ¨è¿›è¡Œçš„è¯·æ±‚æ—¶ï¼Œ`isLoading` ä¼šå˜ä¸º `true` ã€‚

ç®€è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `isValidating` æ¥è¡¨ç¤ºæ¯æ¬¡æ­£åœ¨è¿›è¡Œçš„é‡æ–°è¯·æ±‚ï¼›ä½¿ç”¨ `isLoading` æ¥è¡¨ç¤º SWR æ­£åœ¨é‡æ–°è¯·æ±‚ä¸­ï¼Œä½†ç›®å‰è¿˜æ²¡æœ‰æ•°æ®å¯ä»¥å±•ç¤ºã€‚

<Callout emoji="ğŸ“">
  é¢„è®¾æ•°æ®ï¼ˆFallback Dataï¼‰å’Œä¹‹å‰çš„æ•°æ®ï¼ˆPrevious Dataï¼‰ä¸ä¼šè¢«è®¤ä¸ºæ˜¯â€œå·²åŠ è½½çš„æ•°æ®â€ï¼Œå› æ­¤åœ¨è®¾ç½®äº†é¢„è®¾æ•°æ®æˆ–å¯ç”¨ `keepPreviousData` é€‰é¡¹æ—¶ï¼Œä½ å¯èƒ½æœ‰æ•°æ®è¦å±•ç¤ºã€‚
</Callout>

```jsx
function Stock() {
  const { data, isLoading, isValidating } = useSWR(STOCK_API, fetcher, {
    refreshInterval: 3000
  });

  // å¦‚æœåˆå§‹æ•°æ®ä»åœ¨åŠ è½½ï¼Œè¿™é‡Œå°†ä¸å±•ç¤ºä»»ä½•å†…å®¹ã€‚
  // æˆ‘ä»¬åœ¨è¿™é‡Œè¿”å›ä¸€ä¸ªéª¨æ¶å±ã€‚

  if (isLoading) return <div className="skeleton" />;

  // å¦åˆ™å±•ç¤ºå“åº”æ•°æ®å’Œä¸€ä¸ªè¡¨ç¤ºåå°æ­£åœ¨é‡æ–°è¯·æ±‚çš„åŠ è½½å™¨ã€‚
  return (
    <>
      <div>${data}</div>
      {isValidating ? <div className="spinner" /> : null}
    </>
  );
}
```

![An example of using the isLoading state](/img/understanding/isloading.gif)

ç‚¹å‡» [è¿™é‡Œ](https://codesandbox.io/s/swr-isloading-jtopow) æŸ¥çœ‹å®Œæ•´ä»£ç ç¤ºä¾‹ã€‚

## è¿”å›ä¹‹å‰çš„æ•°æ®ä»¥è·å¾—æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ [#return-previous-data-for-better-ux]

åœ¨ç”¨æˆ·è¿ç»­æ“ä½œçš„æƒ…å†µä¸‹è¿›è¡Œæ•°æ®è¯·æ±‚æ—¶ï¼Œä¾‹å¦‚è¾“å…¥æ—¶å®æ—¶æœç´¢ï¼Œä¿ç•™ä¹‹å‰çš„æ•°æ®å¯ä»¥æå¤§æå‡ç”¨æˆ·ä½“éªŒï¼Œ`keepPreviousData` é€‰é¡¹å¯ä»¥ç”¨äºå¯ç”¨è¯¥è¡Œä¸ºã€‚ä¸‹ä¾‹æ˜¯ä¸€ä¸ªç®€å•çš„ç”¨æˆ·æœç´¢ç•Œé¢:

```jsx
function Search() {
  const [search, setSearch] = React.useState('');

  const { data, isLoading } = useSWR(`/search?q=${search}`, fetcher, {
    keepPreviousData: true
  });

  return (
    <div>
      <input
        type="text"
        value={search}
        onChange={(e) => setSearch(e.target.value)}
        placeholder="Search..."
      />

      <div className={isLoading ? "loading" : ""}>
        {data?.products.map(item => <Product key={item.id} name={item.name} />)
      </div>
    </div>
  );
}
```

å¦‚æœå¯ç”¨äº† `keepPreviousData`ï¼Œå³ä½¿æˆ‘ä»¬æ”¹å˜äº† SWR key å€¼å¹¶ä»¥æ–°çš„ key å€¼é‡æ–°å¼€å§‹åŠ è½½ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥ä¿ç•™ä¹‹å‰çš„æ•°æ®ã€‚

<Video
  src="https://user-images.githubusercontent.com/3676859/163695903-a3eb1259-180e-41e0-821e-21c320201194.mp4"
  caption="å½“å¯ç”¨ keepPreviousData æ—¶ï¼Œä¿ç•™ä¸Šä¸€æ¬¡æœç´¢çš„ç»“æœ"
  ratio={640/730}
/>

åœ¨è¿™é‡ŒæŸ¥çœ‹å®Œæ•´ä»£ç ç¤ºä¾‹ï¼šhttps://codesandbox.io/s/swr-keeppreviousdata-fsjz3m

## æ€§èƒ½ä¾èµ–å…³ç³»æ”¶é›† [#dependency-collection-for-performance]

SWR åªä¼šåœ¨ç»„ä»¶ä¸­æ‰€ä½¿ç”¨çš„çŠ¶æ€è¢«æ›´æ–°æ—¶ï¼Œè§¦å‘é‡æ–°æ¸²æŸ“ã€‚å¦‚æœåªåœ¨ç»„ä»¶ä¸­ä½¿ç”¨ `data`ï¼ŒSWR å°†å¿½ç•¥å…¶ä»–å±æ€§ï¼ˆå¦‚ `isValidating` å’Œ `isLoading`ï¼‰çš„æ›´æ–°ã€‚è¿™å¤§å¤§å‡å°‘äº†æ¸²æŸ“æ¬¡æ•°ã€‚ç‚¹å‡» [è¿™é‡Œ](/docs/advanced/performance#dependency-collection) æŸ¥çœ‹æ›´å¤šä¿¡æ¯ã€‚
